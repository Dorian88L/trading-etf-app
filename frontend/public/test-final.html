<!DOCTYPE html>
<html>
<head>
    <title>ğŸš€ Test Final - Applications RelancÃ©es</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .box { border: 2px solid #ddd; margin: 15px 0; padding: 20px; border-radius: 8px; }
        .success { border-color: #4CAF50; background: #f0f8f0; }
        .info { border-color: #2196F3; background: #f0f8ff; }
        .btn { background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; margin: 8px; }
        .btn:hover { background: #45a049; }
        .status { display: inline-block; padding: 5px 10px; border-radius: 15px; margin: 5px; font-weight: bold; }
        .online { background: #d4edda; color: #155724; }
        .offline { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸš€ Test Final - Applications RelancÃ©es</h1>
    
    <div class="box success">
        <h2>âœ… Ã‰tat des Applications</h2>
        <p><strong>Backend:</strong> <span id="backend-status" class="status">â³ Test en cours...</span></p>
        <p><strong>Frontend:</strong> <span id="frontend-status" class="status">â³ Test en cours...</span></p>
        <p><strong>Communication:</strong> <span id="communication-status" class="status">â³ Test en cours...</span></p>
    </div>

    <div class="box info">
        <h2>ğŸ“‹ Configuration ConfirmÃ©e</h2>
        <ul>
            <li>âœ… <strong>Backend:</strong> http://217.154.120.215:8000</li>
            <li>âœ… <strong>Frontend:</strong> https://investeclaire.fr (port 3000)</li>
            <li>âœ… <strong>API URL:</strong> http://217.154.120.215:8000</li>
            <li>âœ… <strong>CORS:</strong> AutorisÃ© pour toutes origines</li>
        </ul>
    </div>

    <div class="box">
        <h2>ğŸ§ª Tests de Communication</h2>
        <button class="btn" onclick="runAllTests()">ğŸ” Lancer Tous les Tests</button>
        <button class="btn" onclick="testRegistration()">ğŸ“ Test d'Inscription</button>
        <button class="btn" onclick="window.location.href='/register'">ğŸš€ Page Register</button>
        
        <div id="test-results"></div>
    </div>

    <script>
        async function checkBackend() {
            try {
                const response = await fetch('http://217.154.120.215:8000/health');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('backend-status').textContent = 'âœ… ONLINE';
                    document.getElementById('backend-status').className = 'status online';
                    return true;
                }
            } catch (error) {
                document.getElementById('backend-status').textContent = 'âŒ OFFLINE';
                document.getElementById('backend-status').className = 'status offline';
                return false;
            }
        }

        async function checkFrontend() {
            try {
                // Frontend est dÃ©jÃ  accessible puisque cette page se charge
                document.getElementById('frontend-status').textContent = 'âœ… ONLINE';
                document.getElementById('frontend-status').className = 'status online';
                return true;
            } catch (error) {
                document.getElementById('frontend-status').textContent = 'âŒ OFFLINE';
                document.getElementById('frontend-status').className = 'status offline';
                return false;
            }
        }

        async function testCommunication() {
            try {
                const response = await fetch('http://217.154.120.215:8000/api/v1/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: `test-final-${Date.now()}@example.com`,
                        password: 'test123',
                        full_name: 'Test Final Communication'
                    })
                });
                
                if (response.ok) {
                    document.getElementById('communication-status').textContent = 'âœ… PARFAITE';
                    document.getElementById('communication-status').className = 'status online';
                    return true;
                }
            } catch (error) {
                document.getElementById('communication-status').textContent = 'âŒ Ã‰CHEC';
                document.getElementById('communication-status').className = 'status offline';
                return false;
            }
        }

        async function runAllTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3>ğŸ”„ Tests en cours...</h3>';
            
            let report = '<h3>ğŸ“Š RÃ©sultats des Tests:</h3>';
            
            // Test 1: Backend
            const backendOk = await checkBackend();
            report += `<p>ğŸ–¥ï¸ <strong>Backend:</strong> ${backendOk ? 'âœ… Fonctionnel' : 'âŒ ProblÃ¨me'}</p>`;
            
            // Test 2: Frontend
            const frontendOk = await checkFrontend();
            report += `<p>ğŸŒ <strong>Frontend:</strong> ${frontendOk ? 'âœ… Fonctionnel' : 'âŒ ProblÃ¨me'}</p>`;
            
            // Test 3: Communication
            const commOk = await testCommunication();
            report += `<p>ğŸ”— <strong>Communication:</strong> ${commOk ? 'âœ… Parfaite' : 'âŒ Ã‰chec'}</p>`;
            
            // Test 4: Configuration
            report += `<p>âš™ï¸ <strong>Configuration:</strong> âœ… IP directe (http://217.154.120.215:8000)</p>`;
            
            if (backendOk && frontendOk && commOk) {
                report += `
                    <div style="color: green; padding: 20px; border: 3px solid green; border-radius: 10px; margin-top: 20px;">
                        <h2>ğŸ‰ TOUT FONCTIONNE PARFAITEMENT !</h2>
                        <p><strong>âœ… Backend:</strong> En ligne et accessible</p>
                        <p><strong>âœ… Frontend:</strong> En ligne et fonctionnel</p>
                        <p><strong>âœ… Communication:</strong> Frontend â†” Backend OK</p>
                        <p><strong>ğŸ¯ La page Register est prÃªte Ã  l'utilisation !</strong></p>
                        <button onclick="window.location.href='/register'" style="background: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">
                            ğŸ“ Utiliser la Page Register
                        </button>
                    </div>
                `;
            } else {
                report += `
                    <div style="color: red; padding: 15px; border: 2px solid red; border-radius: 8px;">
                        <p>âŒ <strong>ProblÃ¨me dÃ©tectÃ© !</strong> Certains composants ne fonctionnent pas correctement.</p>
                    </div>
                `;
            }
            
            results.innerHTML = report;
        }

        async function testRegistration() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3>ğŸ“ Test d\'inscription en cours...</h3>';
            
            try {
                const testEmail = `inscription-test-${Date.now()}@example.com`;
                const response = await fetch('http://217.154.120.215:8000/api/v1/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        email: testEmail,
                        password: 'test123',
                        full_name: 'Test Inscription Finale'
                    })
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    results.innerHTML = `
                        <div style="color: green; padding: 20px; border: 3px solid green; border-radius: 10px;">
                            <h2>âœ… INSCRIPTION TEST RÃ‰USSIE !</h2>
                            <p><strong>Email:</strong> ${userData.email}</p>
                            <p><strong>ID:</strong> ${userData.id}</p>
                            <p><strong>Statut:</strong> ${response.status} OK</p>
                            <p><strong>ğŸ¯ La page Register fonctionne parfaitement !</strong></p>
                        </div>
                    `;
                } else {
                    const errorText = await response.text();
                    results.innerHTML = `
                        <div style="color: orange; padding: 15px; border: 2px solid orange; border-radius: 8px;">
                            <p>âš ï¸ RÃ©ponse HTTP ${response.status}</p>
                            <p>DÃ©tails: ${errorText}</p>
                        </div>
                    `;
                }
            } catch (error) {
                results.innerHTML = `
                    <div style="color: red; padding: 15px; border: 2px solid red; border-radius: 8px;">
                        <p>âŒ Erreur de communication: ${error.message}</p>
                        <p>VÃ©rifiez que le backend est en ligne.</p>
                    </div>
                `;
            }
        }

        // Auto-test au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkBackend();
                checkFrontend();
                testCommunication();
            }, 1000);
        });
    </script>

    <div class="box success">
        <h2>ğŸ“‹ RÃ©sumÃ© de la Configuration</h2>
        <p><strong>âœ… Applications relancÃ©es et configurÃ©es :</strong></p>
        <ul>
            <li>ğŸ–¥ï¸ <strong>Backend:</strong> uvicorn sur port 8000 (IP directe)</li>
            <li>ğŸŒ <strong>Frontend:</strong> React sur port 3000 (via nginx SSL)</li>
            <li>ğŸ”— <strong>Communication:</strong> Frontend â†’ Backend via IP directe</li>
            <li>âš™ï¸ <strong>Configuration:</strong> .env modifiÃ© pour utiliser IP directe</li>
            <li>ğŸš€ <strong>Page Register:</strong> PrÃªte avec titre "MIXED CONTENT RÃ‰SOLU"</li>
        </ul>
    </div>
</body>
</html>