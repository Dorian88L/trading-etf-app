<!DOCTYPE html>
<html>
<head>
    <title>🔒 Forcer l'Acceptation du Certificat SSL</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .box { border: 2px solid #ddd; margin: 15px 0; padding: 20px; border-radius: 8px; }
        .error { border-color: #f44336; background: #fdf2f2; }
        .warning { border-color: #ff9800; background: #fff3e0; }
        .success { border-color: #4CAF50; background: #f0f8f0; }
        .info { border-color: #2196F3; background: #f0f8ff; }
        .btn { background: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; margin: 10px; font-size: 18px; }
        .btn:hover { background: #45a049; }
        .btn-warning { background: #ff9800; }
        .btn-error { background: #f44336; }
        iframe { width: 100%; height: 400px; border: 2px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>🔒 Forcer l'Acceptation du Certificat SSL</h1>
    
    <div class="box error">
        <h2>❌ Problème SSL Détecté</h2>
        <p>Le certificat SSL de <code>api.investeclaire.fr</code> est auto-signé et rejeté par votre navigateur.</p>
        <p><strong>Erreur typical:</strong> "Failed to fetch" ou "SSL certificate problem"</p>
    </div>

    <div class="box warning">
        <h2>🛠️ Solution 1: Iframe de Forçage</h2>
        <p>Cette iframe va charger directement l'API et forcer l'affichage de l'erreur SSL :</p>
        <iframe src="https://api.investeclaire.fr/docs" 
                id="ssl-iframe"
                onerror="handleIframeError()"
                onload="handleIframeLoad()">
        </iframe>
        <p><small>Si vous voyez une erreur SSL dans l'iframe ci-dessus, cliquez sur "Avancé" puis "Continuer vers api.investeclaire.fr"</small></p>
    </div>

    <div class="box info">
        <h2>🔗 Solution 2: Liens Directs</h2>
        <p>Cliquez sur ces liens pour forcer l'acceptation du certificat :</p>
        
        <button class="btn btn-warning" onclick="window.open('https://api.investeclaire.fr/docs', '_blank')">
            📋 Ouvrir Documentation API
        </button>
        
        <button class="btn btn-warning" onclick="window.open('https://api.investeclaire.fr/health', '_blank')">
            💓 Ouvrir Health Check
        </button>
        
        <button class="btn btn-warning" onclick="window.open('https://api.investeclaire.fr/', '_blank')">
            🏠 Ouvrir Page Racine API
        </button>
    </div>

    <div class="box info">
        <h2>📱 Solution 3: Test Direct</h2>
        <p>Testez la connexion directement dans cette page :</p>
        
        <button class="btn" onclick="testDirectConnection()">
            🧪 Test Connexion SSL Directe
        </button>
        
        <div id="test-results"></div>
    </div>

    <div class="box success">
        <h2>✅ Après Acceptation du Certificat</h2>
        <p>Une fois que vous avez accepté le certificat SSL :</p>
        
        <button class="btn" onclick="testFinalConnection()">
            🎯 Test Connexion Finale
        </button>
        
        <button class="btn" onclick="window.location.href='/register'">
            📝 Aller à Register
        </button>
        
        <div id="final-results"></div>
    </div>

    <script>
        function handleIframeError() {
            console.log('Iframe error - SSL certificate issue detected');
        }

        function handleIframeLoad() {
            console.log('Iframe loaded successfully');
        }

        async function testDirectConnection() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>🔄 Test en cours...</p>';
            
            const tests = [
                { name: 'Health Check', url: 'https://api.investeclaire.fr/health' },
                { name: 'Documentation', url: 'https://api.investeclaire.fr/docs' },
                { name: 'Root API', url: 'https://api.investeclaire.fr/' }
            ];
            
            let report = '<h3>📊 Résultats des Tests:</h3>';
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url, { 
                        mode: 'cors',
                        method: 'GET'
                    });
                    
                    if (response.ok) {
                        report += `<p style="color: green;">✅ ${test.name}: OK (${response.status})</p>`;
                    } else {
                        report += `<p style="color: orange;">⚠️ ${test.name}: HTTP ${response.status}</p>`;
                    }
                } catch (error) {
                    report += `<p style="color: red;">❌ ${test.name}: ${error.message}</p>`;
                    
                    // Créer un lien direct pour forcer l'acceptation
                    report += `<p style="margin-left: 20px;"><a href="${test.url}" target="_blank" style="color: blue;">🔗 Cliquez ici pour ouvrir ${test.name} et accepter le certificat</a></p>`;
                }
            }
            
            results.innerHTML = report;
        }

        async function testFinalConnection() {
            const results = document.getElementById('final-results');
            results.innerHTML = '<p>🔄 Test final en cours...</p>';
            
            try {
                // Test d'inscription réelle
                const response = await fetch('https://api.investeclaire.fr/api/v1/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        email: `ssl-test-${Date.now()}@example.com`,
                        password: 'test123',
                        full_name: 'SSL Test Final'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML = `
                        <div style="color: green; padding: 15px; border: 2px solid green; border-radius: 8px; margin-top: 10px;">
                            <h3>🎉 SUCCÈS COMPLET !</h3>
                            <p><strong>✅ Certificat SSL accepté</strong></p>
                            <p><strong>✅ Connexion API fonctionnelle</strong></p>
                            <p><strong>✅ Inscription réussie:</strong> ${data.email}</p>
                            <p><strong>🎯 La page Register fonctionne maintenant parfaitement !</strong></p>
                            <button onclick="window.location.href='/register'" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
                                📝 Aller à la Page Register
                            </button>
                        </div>
                    `;
                } else {
                    const errorText = await response.text();
                    results.innerHTML = `
                        <div style="color: orange; padding: 10px; border: 2px solid orange; border-radius: 5px;">
                            <p>⚠️ Connexion SSL OK, mais erreur HTTP ${response.status}</p>
                            <p>Détails: ${errorText}</p>
                        </div>
                    `;
                }
            } catch (error) {
                results.innerHTML = `
                    <div style="color: red; padding: 10px; border: 2px solid red; border-radius: 5px;">
                        <p>❌ Certificat SSL toujours rejeté: ${error.message}</p>
                        <p>Essayez d'ouvrir manuellement: <a href="https://api.investeclaire.fr/docs" target="_blank">https://api.investeclaire.fr/docs</a></p>
                    </div>
                `;
            }
        }

        // Auto-test au chargement
        setTimeout(() => {
            console.log('🔒 Page de forçage SSL chargée');
            testDirectConnection();
        }, 1000);
    </script>

    <div class="box warning">
        <h2>🔧 Instructions Étape par Étape</h2>
        <ol>
            <li><strong>Cliquez</strong> sur l'un des boutons "Ouvrir..." ci-dessus</li>
            <li><strong>Dans le nouvel onglet</strong>, vous verrez une erreur SSL</li>
            <li><strong>Cliquez sur "Avancé"</strong> (ou "Advanced")</li>
            <li><strong>Cliquez sur "Continuer vers api.investeclaire.fr"</strong> (ou "Proceed to api.investeclaire.fr")</li>
            <li><strong>Revenez ici</strong> et cliquez sur "Test Connexion Finale"</li>
            <li><strong>Si réussi</strong>, allez sur la page Register</li>
        </ol>
    </div>
</body>
</html>